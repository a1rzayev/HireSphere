@model HireSphere.Adminpanel.Models.DashboardViewModel
@{
    ViewData["Title"] = "Analytics Dashboard";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-chart-line me-2"></i>Analytics Dashboard</h2>
    <div>
        <a href="@Url.Action("Users")" class="btn btn-outline-primary me-2">
            <i class="fas fa-users me-1"></i>User Analytics
        </a>
        <a href="@Url.Action("Jobs")" class="btn btn-outline-warning me-2">
            <i class="fas fa-briefcase me-1"></i>Job Analytics
        </a>
        <a href="@Url.Action("Companies")" class="btn btn-outline-success">
            <i class="fas fa-building me-1"></i>Company Analytics
        </a>
    </div>
</div>

<!-- Statistics Overview -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-1">@Model.UserStatistics.TotalUsers</h4>
                        <p class="mb-0">Total Users</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-users fa-2x opacity-75"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <small>+@Model.UserStatistics.NewUsersThisMonth this month</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-1">@Model.JobStatistics.TotalJobs</h4>
                        <p class="mb-0">Total Jobs</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-briefcase fa-2x opacity-75"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <small>+@Model.JobStatistics.NewJobsThisMonth this month</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-1">@Model.CompanyStatistics.TotalCompanies</h4>
                        <p class="mb-0">Total Companies</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-building fa-2x opacity-75"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <small>+@Model.CompanyStatistics.NewCompaniesThisMonth this month</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="mb-1">@Model.ApplicationStatistics.TotalApplications</h4>
                        <p class="mb-0">Total Applications</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-file-alt fa-2x opacity-75"></i>
                    </div>
                </div>
                <div class="mt-2">
                    <small>@Model.ApplicationStatistics.AcceptedCount accepted</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>User Roles Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="userRolesChart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Job Types Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="jobTypesChart" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Application Status Chart -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Application Status Overview</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <canvas id="applicationStatusChart" height="200"></canvas>
                    </div>
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-6 mb-3">
                                <div class="text-center">
                                    <h4 class="text-primary">@Model.ApplicationStatistics.AppliedCount</h4>
                                    <small class="text-muted">Applied</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="text-center">
                                    <h4 class="text-info">@Model.ApplicationStatistics.ScreeningCount</h4>
                                    <small class="text-muted">Screening</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="text-center">
                                    <h4 class="text-warning">@Model.ApplicationStatistics.InterviewCount</h4>
                                    <small class="text-muted">Interview</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="text-center">
                                    <h4 class="text-success">@Model.ApplicationStatistics.AcceptedCount</h4>
                                    <small class="text-muted">Accepted</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Monthly Trends -->
<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Monthly User Registration</h5>
            </div>
            <div class="card-body">
                <canvas id="monthlyUsersChart" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Monthly Job Postings</h5>
            </div>
            <div class="card-body">
                <canvas id="monthlyJobsChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // User Roles Chart
            const userRolesCtx = document.getElementById('userRolesChart').getContext('2d');
            new Chart(userRolesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Admins', 'Employers', 'Job Seekers'],
                    datasets: [{
                        data: [@Model.UserStatistics.AdminCount, @Model.UserStatistics.EmployerCount, @Model.UserStatistics.JobSeekerCount],
                        backgroundColor: ['#dc3545', '#28a745', '#007bff']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Job Types Chart
            const jobTypesCtx = document.getElementById('jobTypesChart').getContext('2d');
            new Chart(jobTypesCtx, {
                type: 'bar',
                data: {
                    labels: ['Full Time', 'Part Time', 'Contract', 'Internship', 'Temporary'],
                    datasets: [{
                        label: 'Jobs',
                        data: [@Model.JobStatistics.JobTypeCounts.FirstOrDefault(j => j.JobType == "FullTime")?.Count ?? 0, 
                               @Model.JobStatistics.JobTypeCounts.FirstOrDefault(j => j.JobType == "PartTime")?.Count ?? 0,
                               @Model.JobStatistics.JobTypeCounts.FirstOrDefault(j => j.JobType == "Contract")?.Count ?? 0,
                               @Model.JobStatistics.JobTypeCounts.FirstOrDefault(j => j.JobType == "Internship")?.Count ?? 0,
                               @Model.JobStatistics.JobTypeCounts.FirstOrDefault(j => j.JobType == "Temporary")?.Count ?? 0],
                        backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Application Status Chart
            const applicationStatusCtx = document.getElementById('applicationStatusChart').getContext('2d');
            new Chart(applicationStatusCtx, {
                type: 'bar',
                data: {
                    labels: ['Applied', 'Screening', 'Interview', 'Offered', 'Accepted', 'Rejected', 'Withdrawn'],
                    datasets: [{
                        label: 'Applications',
                        data: [@Model.ApplicationStatistics.AppliedCount, 
                               @Model.ApplicationStatistics.ScreeningCount,
                               @Model.ApplicationStatistics.InterviewCount,
                               @Model.ApplicationStatistics.OfferedCount,
                               @Model.ApplicationStatistics.AcceptedCount,
                               @Model.ApplicationStatistics.RejectedCount,
                               @Model.ApplicationStatistics.WithdrawnCount],
                        backgroundColor: ['#007bff', '#17a2b8', '#ffc107', '#28a745', '#28a745', '#dc3545', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Monthly Users Chart
            const monthlyUsersCtx = document.getElementById('monthlyUsersChart').getContext('2d');
            new Chart(monthlyUsersCtx, {
                type: 'line',
                data: {
                    labels: [@Html.Raw(string.Join(", ", Model.UserStatistics.MonthlyUsers.Select(m => $"'{m.Month}'")))],
                    datasets: [{
                        label: 'New Users',
                        data: [@string.Join(", ", Model.UserStatistics.MonthlyUsers.Select(m => m.Count))],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Monthly Jobs Chart
            const monthlyJobsCtx = document.getElementById('monthlyJobsChart').getContext('2d');
            new Chart(monthlyJobsCtx, {
                type: 'line',
                data: {
                    labels: [@Html.Raw(string.Join(", ", Model.JobStatistics.MonthlyJobs.Select(m => $"'{m.Month}'")))],
                    datasets: [{
                        label: 'New Jobs',
                        data: [@string.Join(", ", Model.JobStatistics.MonthlyJobs.Select(m => m.Count))],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
}
